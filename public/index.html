<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#007AFF" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <!-- Client Hints é…ç½® -->
    <meta http-equiv="Accept-CH"
        content="Sec-CH-UA, Sec-CH-UA-Mobile, Sec-CH-UA-Platform, Sec-CH-UA-Platform-Version, Sec-CH-UA-Arch, Sec-CH-UA-Model, Sec-CH-UA-Full-Version, Sec-CH-UA-Full-Version-List" />
    <meta http-equiv="Permissions-Policy"
        content="ch-ua=*, ch-ua-arch=*, ch-ua-full-version=*, ch-ua-full-version-list=*, ch-ua-mobile=*, ch-ua-model=*, ch-ua-platform=*, ch-ua-platform-version=*" />
    <meta http-equiv="Critical-CH" content="Sec-CH-UA-Platform, Sec-CH-UA-Mobile" />
    <title>è®¾å¤‡æ£€æµ‹</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main class="app-container" role="main">
        <header class="navigation-bar" role="banner">
            <div class="nav-content">
                <h1 class="nav-title">è®¾å¤‡æ£€æµ‹</h1>
                <p class="nav-subtitle">æ™ºèƒ½ç³»ç»Ÿè¯†åˆ«</p>
            </div>
        </header>

        <div class="content-grid">
            <section class="info-card primary-card" aria-labelledby="summary-heading">
                <header class="card-header">
                    <h2 id="summary-heading" class="card-title">æ£€æµ‹ç»“æœ</h2>
                </header>
                <div class="card-body">
                    <div id="summary" class="status-indicator" role="status" aria-live="polite">
                        <span class="status-text">æ­£åœ¨åˆ†æç³»ç»Ÿç‰¹å¾...</span>
                    </div>
                    <dl class="info-list">
                        <div class="info-row">
                            <dt>ç½®ä¿¡åº¦</dt>
                            <dd class="progress-container">
                                <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                    aria-valuenow="0">
                                    <div id="confBar" class="progress-fill"></div>
                                </div>
                                <span id="confPct" class="progress-percentage">0%</span>
                            </dd>
                        </div>
                        <div class="info-row">
                            <dt>ç³»ç»Ÿè¯„åˆ†</dt>
                            <dd id="scoreBoard" class="score-display"></dd>
                        </div>
                    </dl>
                    <div id="advancedDetectionContainer" class="advanced-detection-container" style="display: none;">
                        <button id="advancedDetectionBtn" class="advanced-detection-btn">
                            ğŸ” é«˜çº§æ£€æµ‹
                        </button>
                    </div>
                </div>
            </section>

            <section class="info-card secondary-card" aria-labelledby="evidence-heading">
                <header class="card-header">
                    <h2 id="evidence-heading" class="card-title">æ£€æµ‹è¿‡ç¨‹</h2>
                </header>
                <div class="card-body">
                    <ul id="steps" class="step-list" role="list"></ul>
                </div>
            </section>
        </div>
    </main>

  <!-- åœ¨ </main> æ ‡ç­¾å‰æ·»åŠ è¿™ä¸ªè¡¥å……åŠŸèƒ½åŒºåŸŸ -->
<section class="info-card" aria-labelledby="tools-heading" style="margin-top: 24px;">
    <header class="card-header">
        <h2 id="tools-heading" class="card-title">ç³»ç»Ÿå·¥å…·</h2>
    </header>
    <div class="card-body">
        <div class="btn-group">
            <button id="fontDetectBtn" class="btn secondary">
                ğŸ¯ å­—ä½“æ£€æµ‹
            </button>
            <button id="mediaCapBtn" class="btn secondary">
                ğŸ“º åª’ä½“èƒ½åŠ›
            </button>
            <button id="perfMeasureBtn" class="btn secondary">
                âš¡ æ€§èƒ½æµ‹è¯•
            </button>
            <button id="browserFeatureBtn" class="btn secondary">
                ğŸŒ æµè§ˆå™¨ç‰¹æ€§
            </button>
            <button id="canvasToggleBtn" class="btn secondary">
                ğŸ¨ Canvasæ§åˆ¶
            </button>
            <button id="osInfoBtn" class="btn secondary">
                ğŸ’» ç³»ç»Ÿä¿¡æ¯
            </button>
        </div>
        
        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div id="toolsResults" style="margin-top: 16px; display: none;">
            <div class="status-indicator">
                <span id="toolsStatus">å·¥å…·ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</span>
            </div>
            <pre id="toolsOutput" style="background: var(--fill-primary); padding: 12px; border-radius: 8px; font-size: 12px; max-height: 300px; overflow: auto; margin-top: 12px; display: none;"></pre>
        </div>
    </div>
</section>


<!-- åœ¨ç°æœ‰çš„å·¥å…·æŒ‰é’®åæ·»åŠ  -->
<section class="info-card" aria-labelledby="webgl-control-heading" style="margin-top: 24px;">
    <header class="card-header">
        <h2 id="webgl-control-heading" class="card-title">WebGL æ§åˆ¶</h2>
    </header>
    <div class="card-body">
        <div class="btn-group">
            <button id="webglEnableBtn" class="btn secondary">
                ğŸ¯ å¯ç”¨ WebGL
            </button>
            <button id="webglDisableBtn" class="btn secondary">
                ğŸš« ç¦ç”¨ WebGL
            </button>
            <button id="webglStatusBtn" class="btn secondary">
                ğŸ” çŠ¶æ€æ£€æµ‹
            </button>
            <button id="webglToggleBtn" class="btn secondary">
                ğŸ”„ åˆ‡æ¢çŠ¶æ€
            </button>
        </div>
        
        <!-- WebGL çŠ¶æ€æ˜¾ç¤º -->
        <div id="webglStatus" style="margin-top: 16px;">
            <div class="status-indicator">
                <span id="webglStatusText">WebGL çŠ¶æ€: æ£€æµ‹ä¸­...</span>
            </div>
            <div id="webglDetails" style="margin-top: 8px; font-size: 12px; color: var(--label-tertiary); display: none;"></div>
        </div>

        <!-- WebGL æ§åˆ¶ç»“æœ -->
        <div id="webglResults" style="margin-top: 16px; display: none;">
            <div class="status-indicator">
                <span id="webglResultText">WebGL æ§åˆ¶ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</span>
            </div>
            <pre id="webglOutput" style="background: var(--fill-primary); padding: 12px; border-radius: 8px; font-size: 12px; max-height: 200px; overflow: auto; margin-top: 12px; display: none;"></pre>
        </div>
    </div>
</section>

<script>
// å·¥å…·æŒ‰é’®äº‹ä»¶ç›‘å¬
document.addEventListener('DOMContentLoaded', function() {
    // å­—ä½“æ£€æµ‹
    document.getElementById('fontDetectBtn').addEventListener('click', async function() {
        const results = await detectFonts();
        showToolsResult('å­—ä½“æ£€æµ‹ç»“æœ', results);
    });

    // åª’ä½“èƒ½åŠ›æ£€æµ‹
    document.getElementById('mediaCapBtn').addEventListener('click', async function() {
        const results = await checkMediaCapabilities();
        showToolsResult('åª’ä½“ç¼–è§£ç èƒ½åŠ›', results);
    });

    // æ€§èƒ½æµ‹è¯•
    document.getElementById('perfMeasureBtn').addEventListener('click', async function() {
        const results = await measurePerformance();
        showToolsResult('æ€§èƒ½ç‰¹å¾', results);
    });

    // æµè§ˆå™¨ç‰¹æ€§
    document.getElementById('browserFeatureBtn').addEventListener('click', function() {
        const results = checkBrowserFeatures();
        showToolsResult('æµè§ˆå™¨ç‰¹æ€§æ”¯æŒ', results);
    });

    // Canvasæ§åˆ¶
    document.getElementById('canvasToggleBtn').addEventListener('click', function() {
        const currentStatus = window.getCanvasStatus();
        const newStatus = window.toggleCanvas();
        
        showToolsResult('CanvasçŠ¶æ€æ§åˆ¶', {
            å½“å‰çŠ¶æ€: currentStatus.enabled ? 'å¯ç”¨' : 'ç¦ç”¨',
            æ–°çŠ¶æ€: newStatus ? 'å¯ç”¨' : 'ç¦ç”¨',
            è¯¦ç»†ä¿¡æ¯: currentStatus
        });
        
        // æ›´æ–°æŒ‰é’®æ–‡æœ¬
        this.textContent = newStatus ? 'ğŸ¨ ç¦ç”¨Canvas' : 'ğŸ¨ å¯ç”¨Canvas';
    });

    // ç³»ç»Ÿä¿¡æ¯
    document.getElementById('osInfoBtn').addEventListener('click', function() {
        const results = {
            æ“ä½œç³»ç»Ÿ: getOSInfo(),
            è‹¹æœè®¾å¤‡: isAppleDevice(),
            è‹¹æœå¹³å°: isApplePlatform(),
            ç”¨æˆ·ä»£ç†: navigator.userAgent,
            å¹³å°: navigator.platform,
            è¯­è¨€: navigator.language,
            æ—¶åŒº: Intl.DateTimeFormat().resolvedOptions().timeZone
        };
        showToolsResult('ç³»ç»Ÿç¯å¢ƒä¿¡æ¯', results);
    });
});

// æ˜¾ç¤ºå·¥å…·ç»“æœ
function showToolsResult(title, data) {
    const toolsResults = document.getElementById('toolsResults');
    const toolsStatus = document.getElementById('toolsStatus');
    const toolsOutput = document.getElementById('toolsOutput');
    
    toolsResults.style.display = 'block';
    toolsStatus.textContent = title;
    toolsOutput.style.display = 'block';
    toolsOutput.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
}

// åˆå§‹åŒ–CanvasæŒ‰é’®æ–‡æœ¬
document.addEventListener('DOMContentLoaded', function() {
    const canvasStatus = window.getCanvasStatus();
    document.getElementById('canvasToggleBtn').textContent = 
        canvasStatus.enabled ? 'ğŸ¨ ç¦ç”¨Canvas' : 'ğŸ¨ å¯ç”¨Canvas';
});
</script>


<script>
/* ---------- å®Œæ•´çš„å·¥å…·æŒ‰é’®è®¾ç½®å‡½æ•° ---------- */
function setupToolButtons() {
  console.log('ğŸ”§ è®¾ç½®å·¥å…·æŒ‰é’®äº‹ä»¶ç›‘å¬...');

  // å­—ä½“æ£€æµ‹æŒ‰é’®
  const fontDetectBtn = document.getElementById('fontDetectBtn');
  if (fontDetectBtn) {
    fontDetectBtn.addEventListener('click', async function() {
      console.log('ğŸ¯ å¼€å§‹æ‰‹åŠ¨å­—ä½“æ£€æµ‹...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const results = await detectFonts();
        const detectedFonts = Object.entries(results)
          .filter(([font, exists]) => exists)
          .map(([font]) => font);
        
        const detectedCount = detectedFonts.length;
        const detail = `å…±æ£€æµ‹ ${Object.keys(results).length} ç§å­—ä½“ï¼Œå‘ç° ${detectedCount} ç§ï¼š${detectedFonts.join(', ')}`;
        
        showToolsResult('å­—ä½“æ£€æµ‹ç»“æœ', {
          æ€»æ£€æµ‹å­—ä½“æ•°: Object.keys(results).length,
          æ£€æµ‹åˆ°å­—ä½“æ•°: detectedCount,
          æ£€æµ‹åˆ°çš„å­—ä½“: detectedFonts,
          åŸå§‹æ•°æ®: results
        });
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: true,
          title: 'æ‰‹åŠ¨å­—ä½“æ£€æµ‹',
          detail: detail,
          weight: 0,
          targets: []
        });
        
        console.log(`âœ… å­—ä½“æ£€æµ‹å®Œæˆ: å‘ç° ${detectedCount} ç§å­—ä½“`);
      } catch (error) {
        console.error('âŒ å­—ä½“æ£€æµ‹å¤±è´¥:', error);
        showToolsResult('å­—ä½“æ£€æµ‹å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨å­—ä½“æ£€æµ‹å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // åª’ä½“èƒ½åŠ›æ£€æµ‹æŒ‰é’®
  const mediaCapBtn = document.getElementById('mediaCapBtn');
  if (mediaCapBtn) {
    mediaCapBtn.addEventListener('click', async function() {
      console.log('ğŸ“º å¼€å§‹æ‰‹åŠ¨åª’ä½“èƒ½åŠ›æ£€æµ‹...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const results = await checkMediaCapabilities();
        const detail = `HEVC: ${results.hevc ? 'âœ…' : 'âŒ'}, VP9: ${results.vp9 ? 'âœ…' : 'âŒ'}, AV1: ${results.av1 ? 'âœ…' : 'âŒ'}`;
        
        showToolsResult('åª’ä½“ç¼–è§£ç èƒ½åŠ›', {
          HEVC_H265æ”¯æŒ: results.hevc ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
          VP9æ”¯æŒ: results.vp9 ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ', 
          AV1æ”¯æŒ: results.av1 ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
          è¯¦ç»†ç»“æœ: results
        });
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: true,
          title: 'æ‰‹åŠ¨åª’ä½“èƒ½åŠ›æ£€æµ‹',
          detail: detail,
          weight: 0,
          targets: []
        });
        
        console.log('âœ… åª’ä½“èƒ½åŠ›æ£€æµ‹å®Œæˆ:', results);
      } catch (error) {
        console.error('âŒ åª’ä½“èƒ½åŠ›æ£€æµ‹å¤±è´¥:', error);
        showToolsResult('åª’ä½“èƒ½åŠ›æ£€æµ‹å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨åª’ä½“èƒ½åŠ›æ£€æµ‹å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // æ€§èƒ½æµ‹è¯•æŒ‰é’®
  const perfMeasureBtn = document.getElementById('perfMeasureBtn');
  if (perfMeasureBtn) {
    perfMeasureBtn.addEventListener('click', async function() {
      console.log('âš¡ å¼€å§‹æ‰‹åŠ¨æ€§èƒ½æµ‹è¯•...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const results = await measurePerformance();
        const memoryInfo = results.memory ? {
          å·²ä½¿ç”¨å†…å­˜: `${(results.memory.used / 1024 / 1024).toFixed(1)} MB`,
          æ€»å†…å­˜: `${(results.memory.total / 1024 / 1024).toFixed(1)} MB`,
          å†…å­˜é™åˆ¶: `${(results.memory.limit / 1024 / 1024).toFixed(1)} MB`
        } : 'ä¸å¯ç”¨';
        
        const networkInfo = results.connection ? {
          ç½‘ç»œç±»å‹: results.connection.effectiveType,
          ä¸‹è¡Œé€Ÿåº¦: `${results.connection.downlink} Mbps`,
          å¾€è¿”å»¶è¿Ÿ: `${results.connection.rtt} ms`,
          èŠ‚çœæ•°æ®æ¨¡å¼: results.connection.saveData ? 'å¼€å¯' : 'å…³é—­'
        } : 'ä¸å¯ç”¨';
        
        showToolsResult('æ€§èƒ½ç‰¹å¾æ£€æµ‹', {
          å†…å­˜ä¿¡æ¯: memoryInfo,
          ç½‘ç»œä¿¡æ¯: networkInfo,
          è®¾å¤‡åƒç´ æ¯”: results.devicePixelRatio,
          å±å¹•ä¿¡æ¯: results.screen,
          è§†å£ä¿¡æ¯: results.viewport
        });
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: true,
          title: 'æ‰‹åŠ¨æ€§èƒ½æµ‹è¯•',
          detail: `è®¾å¤‡åƒç´ æ¯”: ${results.devicePixelRatio}, å±å¹•: ${results.screen.width}Ã—${results.screen.height}`,
          weight: 0,
          targets: []
        });
        
        console.log('âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ');
      } catch (error) {
        console.error('âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥:', error);
        showToolsResult('æ€§èƒ½æµ‹è¯•å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨æ€§èƒ½æµ‹è¯•å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹æŒ‰é’®
  const browserFeatureBtn = document.getElementById('browserFeatureBtn');
  if (browserFeatureBtn) {
    browserFeatureBtn.addEventListener('click', function() {
      console.log('ğŸŒ å¼€å§‹æ‰‹åŠ¨æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const results = checkBrowserFeatures();
        const supportedFeatures = Object.entries(results)
          .filter(([name, supported]) => supported)
          .map(([name]) => name);
        
        const unsupportedFeatures = Object.entries(results)
          .filter(([name, supported]) => !supported)
          .map(([name]) => name);
        
        const detail = `æ”¯æŒ ${supportedFeatures.length} ä¸ªç‰¹æ€§ï¼Œä¸æ”¯æŒ ${unsupportedFeatures.length} ä¸ªç‰¹æ€§`;
        
        showToolsResult('æµè§ˆå™¨ç‰¹æ€§æ”¯æŒ', {
          æ”¯æŒçš„ç‰¹æ€§æ•°: supportedFeatures.length,
          ä¸æ”¯æŒçš„ç‰¹æ€§æ•°: unsupportedFeatures.length,
          æ”¯æŒçš„ç‰¹æ€§åˆ—è¡¨: supportedFeatures,
          ä¸æ”¯æŒçš„ç‰¹æ€§åˆ—è¡¨: unsupportedFeatures,
          å®Œæ•´ç‰¹æ€§è¡¨: results
        });
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: true,
          title: 'æ‰‹åŠ¨æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹',
          detail: detail,
          weight: 0,
          targets: []
        });
        
        console.log(`âœ… æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹å®Œæˆ: æ”¯æŒ ${supportedFeatures.length} ä¸ªç‰¹æ€§`);
      } catch (error) {
        console.error('âŒ æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹å¤±è´¥:', error);
        showToolsResult('æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // ç³»ç»Ÿä¿¡æ¯æ£€æµ‹æŒ‰é’®
  const osInfoBtn = document.getElementById('osInfoBtn');
  if (osInfoBtn) {
    osInfoBtn.addEventListener('click', function() {
      console.log('ğŸ’» å¼€å§‹æ‰‹åŠ¨ç³»ç»Ÿä¿¡æ¯æ£€æµ‹...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const results = {
          æ“ä½œç³»ç»Ÿ: getOSInfo(),
          è‹¹æœè®¾å¤‡: isAppleDevice(),
          è‹¹æœå¹³å°: isApplePlatform(),
          ç”¨æˆ·ä»£ç†: navigator.userAgent,
          å¹³å°: navigator.platform,
          è¯­è¨€: navigator.language,
          æ—¶åŒº: Intl.DateTimeFormat().resolvedOptions().timeZone,
          CPUæ ¸å¿ƒæ•°: navigator.hardwareConcurrency || 'æœªçŸ¥',
          è®¾å¤‡å†…å­˜: navigator.deviceMemory || 'æœªçŸ¥',
          æœ€å¤§è§¦ç‚¹æ•°: navigator.maxTouchPoints || 0,
          å±å¹•åˆ†è¾¨ç‡: `${screen.width} Ã— ${screen.height}`,
          è‰²å½©æ·±åº¦: screen.colorDepth + 'ä½',
          åƒç´ å¯†åº¦: window.devicePixelRatio || 1,
          åœ¨çº¿çŠ¶æ€: navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿',
          Cookieå¯ç”¨: navigator.cookieEnabled ? 'æ˜¯' : 'å¦',
          Javaå¯ç”¨: navigator.javaEnabled ? 'æ˜¯' : 'å¦'
        };
        
        showToolsResult('ç³»ç»Ÿç¯å¢ƒä¿¡æ¯', results);
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: true,
          title: 'æ‰‹åŠ¨ç³»ç»Ÿä¿¡æ¯æ£€æµ‹',
          detail: `æ“ä½œç³»ç»Ÿ: ${results.æ“ä½œç³»ç»Ÿ}, å¹³å°: ${results.å¹³å°}, CPUæ ¸å¿ƒ: ${results.CPUæ ¸å¿ƒæ•°}`,
          weight: 0,
          targets: []
        });
        
        console.log('âœ… ç³»ç»Ÿä¿¡æ¯æ£€æµ‹å®Œæˆ:', results.æ“ä½œç³»ç»Ÿ);
      } catch (error) {
        console.error('âŒ ç³»ç»Ÿä¿¡æ¯æ£€æµ‹å¤±è´¥:', error);
        showToolsResult('ç³»ç»Ÿä¿¡æ¯æ£€æµ‹å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨ç³»ç»Ÿä¿¡æ¯æ£€æµ‹å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // Canvasæ§åˆ¶æŒ‰é’®
  const canvasToggleBtn = document.getElementById('canvasToggleBtn');
  if (canvasToggleBtn) {
    canvasToggleBtn.addEventListener('click', function() {
      console.log('ğŸ¨ åˆ‡æ¢CanvasçŠ¶æ€...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const currentStatus = window.getCanvasStatus();
        const newStatus = window.toggleCanvas();
        
        const statusInfo = {
          å½“å‰çŠ¶æ€: currentStatus.enabled ? 'å¯ç”¨' : 'ç¦ç”¨',
          æ–°çŠ¶æ€: newStatus ? 'å¯ç”¨' : 'ç¦ç”¨',
          æ”¯æŒçŠ¶æ€: currentStatus.supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
          æ‰‹åŠ¨è¦†ç›–: currentStatus.manualOverride ? 'æ˜¯' : 'å¦'
        };
        
        showToolsResult('CanvasçŠ¶æ€æ§åˆ¶', statusInfo);
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: true,
          title: 'CanvasçŠ¶æ€åˆ‡æ¢',
          detail: `ä» ${statusInfo.å½“å‰çŠ¶æ€} åˆ‡æ¢åˆ° ${statusInfo.æ–°çŠ¶æ€}`,
          weight: 0,
          targets: []
        });
        
        // æ›´æ–°æŒ‰é’®æ–‡æœ¬
        this.textContent = newStatus ? 'ğŸ¨ ç¦ç”¨Canvas' : 'ğŸ¨ å¯ç”¨Canvas';
        
        console.log(`âœ… CanvasçŠ¶æ€åˆ‡æ¢: ${statusInfo.å½“å‰çŠ¶æ€} â†’ ${statusInfo.æ–°çŠ¶æ€}`);
      } catch (error) {
        console.error('âŒ CanvasçŠ¶æ€åˆ‡æ¢å¤±è´¥:', error);
        showToolsResult('CanvasçŠ¶æ€åˆ‡æ¢å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'CanvasçŠ¶æ€åˆ‡æ¢å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // NFCæ£€æµ‹æŒ‰é’®ï¼ˆæ–°å¢ï¼‰
  const nfcDetectBtn = document.getElementById('nfcDetectBtn');
  if (nfcDetectBtn) {
    nfcDetectBtn.addEventListener('click', async function() {
      console.log('ğŸ“± å¼€å§‹æ‰‹åŠ¨NFCæ£€æµ‹...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const results = await checkNFCCapabilities();
        const isSecureContext = window.isSecureContext || location.protocol === 'https:';
        
        const nfcInfo = {
          APIæ”¯æŒ: results.hasAPI ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
          APIç±»å‹: results.apiType || 'æ— ',
          æ‰«æåŠŸèƒ½: results.canScan ? 'å¯ç”¨' : 'ä¸å¯ç”¨',
          å®‰å…¨ä¸Šä¸‹æ–‡: isSecureContext ? 'æ˜¯' : 'å¦',
          é”™è¯¯ä¿¡æ¯: results.error || 'æ— '
        };
        
        showToolsResult('NFCèƒ½åŠ›æ£€æµ‹', nfcInfo);
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: results.hasAPI,
          title: 'æ‰‹åŠ¨NFCæ£€æµ‹',
          detail: `APIæ”¯æŒ: ${nfcInfo.APIæ”¯æŒ}, ç±»å‹: ${nfcInfo.APIç±»å‹}, æ‰«æ: ${nfcInfo.æ‰«æåŠŸèƒ½}`,
          weight: results.hasAPI ? 2 : 0,
          targets: results.hasAPI ? ['android'] : []
        });
        
        console.log(`âœ… NFCæ£€æµ‹å®Œæˆ: ${nfcInfo.APIæ”¯æŒ}`);
      } catch (error) {
        console.error('âŒ NFCæ£€æµ‹å¤±è´¥:', error);
        showToolsResult('NFCæ£€æµ‹å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨NFCæ£€æµ‹å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  // WebGLè¯¦ç»†æ£€æµ‹æŒ‰é’®ï¼ˆæ–°å¢ï¼‰
  const webglDetailBtn = document.getElementById('webglDetailBtn');
  if (webglDetailBtn) {
    webglDetailBtn.addEventListener('click', function() {
      console.log('ğŸ” å¼€å§‹æ‰‹åŠ¨WebGLè¯¦ç»†æ£€æµ‹...');
      this.classList.add('loading');
      this.disabled = true;
      
      try {
        const webglStatus = window.webglManager ? window.webglManager.getStatus() : {
          supported: false,
          enabled: false,
          initialized: false,
          manualOverride: false
        };

        // è·å– WebGL è¯¦ç»†ä¿¡æ¯
        let webglDetails = {};
        if (webglStatus.supported) {
          try {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
              const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
              webglDetails = {
                æ¸²æŸ“å™¨: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'æœªçŸ¥',
                ä¾›åº”å•†: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'æœªçŸ¥',
                ç‰ˆæœ¬: gl.getParameter(gl.VERSION),
                ç€è‰²å™¨ç‰ˆæœ¬: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),
                æŠ—é”¯é½¿: gl.getContextAttributes().antialias ? 'å¯ç”¨' : 'ç¦ç”¨',
                æ·±åº¦ç¼“å†²: gl.getContextAttributes().depth ? 'å¯ç”¨' : 'ç¦ç”¨',
                æ¨¡æ¿ç¼“å†²: gl.getContextAttributes().stencil ? 'å¯ç”¨' : 'ç¦ç”¨'
              };
            }
          } catch (error) {
            webglDetails.é”™è¯¯ = error.message;
          }
        }

        const webglInfo = {
          åŸºç¡€çŠ¶æ€: webglStatus,
          è¯¦ç»†ä¿¡æ¯: webglDetails,
          æ”¯æŒæ‰©å±•: webglStatus.supported ? this.getWebGLExtensions() : []
        };
        
        showToolsResult('WebGLè¯¦ç»†æ£€æµ‹', webglInfo);
        
        // æ·»åŠ åˆ°æ£€æµ‹æ­¥éª¤
        addStep({
          ok: webglStatus.supported,
          title: 'æ‰‹åŠ¨WebGLè¯¦ç»†æ£€æµ‹',
          detail: `æ”¯æŒ: ${webglStatus.supported ? 'æ˜¯' : 'å¦'}, æ¸²æŸ“å™¨: ${webglDetails.æ¸²æŸ“å™¨ || 'æœªçŸ¥'}`,
          weight: 0,
          targets: []
        });
        
        console.log('âœ… WebGLè¯¦ç»†æ£€æµ‹å®Œæˆ');
      } catch (error) {
        console.error('âŒ WebGLè¯¦ç»†æ£€æµ‹å¤±è´¥:', error);
        showToolsResult('WebGLè¯¦ç»†æ£€æµ‹å¤±è´¥', error.message);
        addStep({
          ok: false,
          title: 'æ‰‹åŠ¨WebGLè¯¦ç»†æ£€æµ‹å¤±è´¥',
          detail: error.message,
          weight: 0,
          targets: []
        });
      } finally {
        this.classList.remove('loading');
        this.disabled = false;
      }
    });
  }

  console.log('âœ… æ‰€æœ‰å·¥å…·æŒ‰é’®äº‹ä»¶ç›‘å¬è®¾ç½®å®Œæˆ');
}

// è·å– WebGL æ‰©å±•åˆ—è¡¨ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰
function getWebGLExtensions() {
  try {
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (gl) {
      const extensions = gl.getSupportedExtensions();
      return extensions || [];
    }
  } catch (error) {
    console.error('è·å– WebGL æ‰©å±•å¤±è´¥:', error);
  }
  return [];
}

// åœ¨DOMåŠ è½½å®Œæˆåè®¾ç½®å·¥å…·æŒ‰é’®
document.addEventListener('DOMContentLoaded', function() {
  // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åè®¾ç½®å·¥å…·æŒ‰é’®
  setTimeout(() => {
    setupToolButtons();
    
    // åˆå§‹åŒ–CanvasæŒ‰é’®æ–‡æœ¬
    const canvasStatus = window.getCanvasStatus ? window.getCanvasStatus() : { enabled: true };
    const canvasToggleBtn = document.getElementById('canvasToggleBtn');
    if (canvasToggleBtn) {
      canvasToggleBtn.textContent = canvasStatus.enabled ? 'ğŸ¨ ç¦ç”¨Canvas' : 'ğŸ¨ å¯ç”¨Canvas';
    }
  }, 100);
});
</script>
    
    <!-- å¼¹å¹•é›¨å®¹å™¨ -->
    <div id="danmu-container" aria-hidden="true"></div>

    <!-- WebGLå®¹å™¨ï¼ˆéšè—ï¼‰ -->
    <div id="webgl-container"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999; background:#131115;">
        <div id="main">
            <canvas id="c1" width="1024" height="1024">
                <span>ä¸æ”¯æŒcanvasæµè§ˆå™¨</span>
            </canvas>
        </div>
        <button id="btn">CONFIG</button>
        <div id="config">
            <textarea name="" id="kernel" cols="30" rows="10"></textarea>
            <br />
            <button id="apply">APPLY</button>
            <button id="cancle">CANCLE</button>
        </div>
    </div>

    <script src="script.js"></script>

</html>